/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.css":
/*!***********************!*\
  !*** ./src/index.css ***!
  \***********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/sourceMaps.js */ "./node_modules/css-loader/dist/runtime/sourceMaps.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../node_modules/css-loader/dist/runtime/api.js */ "./node_modules/css-loader/dist/runtime/api.js");
/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);
// Imports


var ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));
// Module
___CSS_LOADER_EXPORT___.push([module.id, ".elem-scroll {\r\n  height: 100%;\r\n  overflow: auto;\r\n}\r\n\r\n.elem-item {\r\n  text-align: center;\r\n}\r\n.a {\r\n  color: blue;\r\n}\r\n", "",{"version":3,"sources":["webpack://./src/index.css"],"names":[],"mappings":"AAAA;EACE,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,kBAAkB;AACpB;AACA;EACE,WAAW;AACb","sourcesContent":[".elem-scroll {\r\n  height: 100%;\r\n  overflow: auto;\r\n}\r\n\r\n.elem-item {\r\n  text-align: center;\r\n}\r\n.a {\r\n  color: blue;\r\n}\r\n"],"sourceRoot":""}]);
// Exports
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);


/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/***/ ((module) => {



/*
  MIT License http://www.opensource.org/licenses/mit-license.php
  Author Tobias Koppers @sokra
*/
module.exports = function (cssWithMappingToString) {
  var list = []; // return the list of modules as css string

  list.toString = function toString() {
    return this.map(function (item) {
      var content = "";
      var needLayer = typeof item[5] !== "undefined";

      if (item[4]) {
        content += "@supports (".concat(item[4], ") {");
      }

      if (item[2]) {
        content += "@media ".concat(item[2], " {");
      }

      if (needLayer) {
        content += "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {");
      }

      content += cssWithMappingToString(item);

      if (needLayer) {
        content += "}";
      }

      if (item[2]) {
        content += "}";
      }

      if (item[4]) {
        content += "}";
      }

      return content;
    }).join("");
  }; // import a list of modules into the list


  list.i = function i(modules, media, dedupe, supports, layer) {
    if (typeof modules === "string") {
      modules = [[null, modules, undefined]];
    }

    var alreadyImportedModules = {};

    if (dedupe) {
      for (var k = 0; k < this.length; k++) {
        var id = this[k][0];

        if (id != null) {
          alreadyImportedModules[id] = true;
        }
      }
    }

    for (var _k = 0; _k < modules.length; _k++) {
      var item = [].concat(modules[_k]);

      if (dedupe && alreadyImportedModules[item[0]]) {
        continue;
      }

      if (typeof layer !== "undefined") {
        if (typeof item[5] === "undefined") {
          item[5] = layer;
        } else {
          item[1] = "@layer".concat(item[5].length > 0 ? " ".concat(item[5]) : "", " {").concat(item[1], "}");
          item[5] = layer;
        }
      }

      if (media) {
        if (!item[2]) {
          item[2] = media;
        } else {
          item[1] = "@media ".concat(item[2], " {").concat(item[1], "}");
          item[2] = media;
        }
      }

      if (supports) {
        if (!item[4]) {
          item[4] = "".concat(supports);
        } else {
          item[1] = "@supports (".concat(item[4], ") {").concat(item[1], "}");
          item[4] = supports;
        }
      }

      list.push(item);
    }
  };

  return list;
};

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/sourceMaps.js":
/*!************************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/sourceMaps.js ***!
  \************************************************************/
/***/ ((module) => {



module.exports = function (item) {
  var content = item[1];
  var cssMapping = item[3];

  if (!cssMapping) {
    return content;
  }

  if (typeof btoa === "function") {
    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));
    var data = "sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64);
    var sourceMapping = "/*# ".concat(data, " */");
    var sourceURLs = cssMapping.sources.map(function (source) {
      return "/*# sourceURL=".concat(cssMapping.sourceRoot || "").concat(source, " */");
    });
    return [content].concat(sourceURLs).concat([sourceMapping]).join("\n");
  }

  return [content].join("\n");
};

/***/ }),

/***/ "./node_modules/escape-html/index.js":
/*!*******************************************!*\
  !*** ./node_modules/escape-html/index.js ***!
  \*******************************************/
/***/ ((module) => {

/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */



/**
 * Module variables.
 * @private
 */

var matchHtmlRegExp = /["'&<>]/;

/**
 * Module exports.
 * @public
 */

module.exports = escapeHtml;

/**
 * Escape special characters in the given string of html.
 *
 * @param  {string} string The string to escape for inserting into HTML
 * @return {string}
 * @public
 */

function escapeHtml(string) {
  var str = '' + string;
  var match = matchHtmlRegExp.exec(str);

  if (!match) {
    return str;
  }

  var escape;
  var html = '';
  var index = 0;
  var lastIndex = 0;

  for (index = match.index; index < str.length; index++) {
    switch (str.charCodeAt(index)) {
      case 34: // "
        escape = '&quot;';
        break;
      case 38: // &
        escape = '&amp;';
        break;
      case 39: // '
        escape = '&#39;';
        break;
      case 60: // <
        escape = '&lt;';
        break;
      case 62: // >
        escape = '&gt;';
        break;
      default:
        continue;
    }

    if (lastIndex !== index) {
      html += str.substring(lastIndex, index);
    }

    lastIndex = index + 1;
    html += escape;
  }

  return lastIndex !== index
    ? html + str.substring(lastIndex, index)
    : html;
}


/***/ }),

/***/ "./node_modules/html5-tag/lib/index.js":
/*!*********************************************!*\
  !*** ./node_modules/html5-tag/lib/index.js ***!
  \*********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {



var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

var _escapeHtml = __webpack_require__(/*! escape-html */ "./node_modules/escape-html/index.js");

var _escapeHtml2 = _interopRequireDefault(_escapeHtml);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// https://www.w3.org/TR/html5/syntax.html#void-elements
// Void elements only have a start tag; end tags must not be specified for void elements.
var voidElements = ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'meta', 'param', 'source', 'track', 'wbr'];

// @param {string} [tag] The tag name. Defaults to 'div'.
// @param {object} attrs HTML attributes.
// @param {string} [text] The content string.
module.exports = function (tag, attrs, text) {
    if ((typeof tag === 'undefined' ? 'undefined' : _typeof(tag)) === 'object') {
        text = attrs;
        attrs = tag;
        tag = 'div';
    }

    var voidElement = voidElements.indexOf(('' + tag).toLowerCase()) >= 0;
    var html = '<' + tag;

    attrs = _extends({}, attrs);
    Object.keys(attrs).forEach(function (name) {
        var value = attrs[name];
        if (typeof value === 'string') {
            value = (0, _escapeHtml2.default)('' + value);
            html += ' ' + name + '="' + value + '"';
        } else if (!!value) {
            html += ' ' + name;
        }
    });

    if (voidElement) {
        html += '>';
    } else if (text !== undefined) {
        html += '>' + text + '</' + tag + '>';
    } else {
        html += '/>';
    }

    return html;
};

/***/ }),

/***/ "./src/infinite-table.js":
/*!*******************************!*\
  !*** ./src/infinite-table.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
class InfiniteTable {

  el = null;

  scrollElement = null;

  contentElement = null;

  rows = [];

  cache = {};

  options = {
    rowsInBlock: 10,
    blocksInCluster: 4,
    rowRender: null,
    data: []
  };

  state = {
    lastClusterIndex: -1,
    itemHeight: 0,
    blockHeight: 0,
    clusterHeight: 0
  };

  constructor(el, options) {
    this.el = el;

    this.options = {
      ...this.options,
      ...options
    }

    this.create()

    this.loadData(this.options.data)
  }

  create () {
    if (this.el) {
      this.scrollElement = document.createElement('div');
      const contentElement = document.createElement('div');
      this.scrollElement.appendChild(contentElement);
      this.contentElement = contentElement;

      this.scrollElement.className = 'elem-scroll'
      this.contentElement.className = 'elem-content'
      this.el.appendChild(this.scrollElement)

      const scrollTop = this.scrollElement.scrollTop;
      this.changeDOM();
      // Restore scroll position
      this.scrollElement.scrollTop = scrollTop;

      // 滚动的监听事件
      this.scrollElement.addEventListener('scroll', () => {
        const clusterIndex = this.getCurrentClusterIndex();
        
        if (this.state.lastClusterIndex !== clusterIndex) {
            this.changeDOM();
        }
        this.state.lastClusterIndex = clusterIndex;
  })
    }
  }

  update () {
    const scrollTop = this.scrollElement.scrollTop
    if (this.state.itemHeight * this.rows.length < scrollTop) {
      this.scrollElement.scrollTop = 0;
      this.state.lastClusterIndex = 0;
    }

    this.changeDOM()
    this.scrollElement.scrollTop = scrollTop;
  }

  loadData (rows) {
    this.rows = rows
    if (!this.rows || this.rows.length === 0) {
      return 
    }
    this.rows = rows.map(r => this.options.rowRender(r))
    this.changeDOM()
  }

  changeDOM () {
    if (!this.state.clusterHeight && this.rows.length > 0) {

      if (this.contentElement.children.length <= 1) {
        this.cache.content = this.setContent(this.rows[0] + this.rows[0] + this.rows[0]);
      }

      this.state = { ...this.state, ...this.computeHeight() };
    }

    let topOffset = 0;
    let bottomOffset = 0;
    let rows = [];

    if (this.rows.length < this.options.rowsInBlock) {
      rows = (this.rows.length > 0) ? this.rows : this.generateEmptyRow();
    } else {
      const rowsInCluster = this.options.rowsInBlock * this.options.blocksInCluster;
      const clusterIndex = this.getCurrentClusterIndex();
      // 渲染的开始索引
      const visibleStart = Math.max((rowsInCluster - this.options.rowsInBlock) * clusterIndex, 0);
      // 渲染的结束索引
      const visibleEnd = visibleStart + rowsInCluster;

      topOffset = Math.max(visibleStart * this.state.itemHeight, 0);
      bottomOffset = Math.max((this.rows.length - visibleEnd) * this.state.itemHeight, 0);

      // Returns a shallow copy of the rows selected from `visibleStart` to `visibleEnd` (`visibleEnd` not included).
      rows = this.rows.slice(visibleStart, visibleEnd);
    }

    let layout = [];

    if (topOffset > 0) {
      if (this.options.keepParity) {
        layout.push(this.renderExtraTag('keep-parity'));
      }
      layout.push(this.renderExtraTag('top-space', topOffset));
    }
    layout.push(...rows);
    if (bottomOffset > 0) {
        layout.push(this.renderExtraTag('bottom-space', bottomOffset));
    }
    this.setContent(layout.join(''))
  }

  computeHeight () {
    if (!this.rows.length) {
      return {
          clusterHeight: 0,
          blockHeight: this.state.blockHeight,
          itemHeight: this.state.itemHeight
      };
    } else {
        const nodes = this.contentElement.children;
        const node = nodes[Math.floor(nodes.length / 2)];

        // 树节点的高度
        let itemHeight = node.offsetHeight;

        // 21 * 50 = 1050
        const blockHeight = itemHeight * this.options.rowsInBlock;
        // 1050 * 4 = 4200
        const clusterHeight = blockHeight * this.options.blocksInCluster;

        return {
            itemHeight,
            blockHeight,
            clusterHeight
        };
    }
  }

  setContent(content) {
    this.contentElement.innerHTML = content;
  }

  generateEmptyRow() {
    const emptyRow = document.createElement('div');
    emptyRow.className = 'emptyClass';
    emptyRow.appendChild(document.createTextNode('No Data'));
    return [emptyRow.outerHTML];
  }

  getCurrentClusterIndex() {
    const { blockHeight, clusterHeight } = this.state;
    if (!blockHeight || !clusterHeight) {
        return 0;
    }
    return Math.floor(this.scrollElement.scrollTop / (clusterHeight - blockHeight)) || 0;
  }

  renderExtraTag(className, height) {
      const tag = document.createElement('div');
      const prefix = 'infinite-tree-';

      tag.className = [
          prefix + 'extra-row',
          prefix + className
      ].join(' ');

      if (height) {
          tag.style.height = height + 'px';
      }

      return tag.outerHTML;
  }

}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (InfiniteTable);

/***/ }),

/***/ "./src/renderer.js":
/*!*************************!*\
  !*** ./src/renderer.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var html5_tag__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! html5-tag */ "./node_modules/html5-tag/lib/index.js");
/* harmony import */ var html5_tag__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(html5_tag__WEBPACK_IMPORTED_MODULE_0__);


function myRenderer (node) {
  return html5_tag__WEBPACK_IMPORTED_MODULE_0___default()('div', {
    'data-id': node.id,
    'class': 'elem-item'
}, node.id);
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (myRenderer);

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index.css */ "./src/index.css");
const InfiniteTable = (__webpack_require__(/*! ./infinite-table */ "./src/infinite-table.js")["default"])
const defaultRowRenderer = (__webpack_require__(/*! ./renderer */ "./src/renderer.js")["default"])
;

let listData = [];
for (let i = 0; i < 1000; i++) {
  listData.push({
    id: i,
    name: i
  })
}

function initTable () {
  const tree = document.createElement('div')
  tree.style.height = '100px'
  tree.style.background="green"

  new InfiniteTable(tree, {
    data: listData,
    rowRender: defaultRowRenderer
  })

  window.document.body.appendChild(tree)
}

initTable()
})();

/******/ })()
;
//# sourceMappingURL=infinite-table.min.js.map